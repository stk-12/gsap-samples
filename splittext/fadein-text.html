<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SplitText Fade-in</title>
<link rel="stylesheet" href="../assets/css/common.css">
<style>
  body {
    text-align: center;
    margin-top: 50px;
  }
  .text {
    font-size: 3rem;
    font-weight: 700;
    margin-bottom: 6rem;
  }
  .btn__txt {
    position: relative;
    display: inline-flex;
    overflow: hidden;
  }
  .btn__txt-item--after {
    position: absolute;
    top: 0;
  }
  .btn__txt-item span {
    display: inline-block;
    line-height: 1.3;
  }
</style>
</head>
<body>
  <div class="text js-split-chars">Chars Text Animation</div>
  <div class="text js-split-words">Words Text Animation</div>
  <div class="text js-split-lines">Lines Text Animation. Lines Text Animation. Lines Text Animation. Lines Text Animation.</div>
  <div class="text js-split-lines-mask">Lines Text Animation inside Mask. Lines Text Animation inside Mask. Lines Text Animation inside Mask.</div>

  <button type="button" class="btn js-play-btn">
    <span class="btn__txt">
      <span class="btn__txt-item btn__txt-item--before js-split-btn-chars">Play Animations</span>
      <span class="btn__txt-item btn__txt-item--after js-split-btn-chars">Play Animations</span>
    </span>
  </button>

<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/gsap@3.13.0/dist/SplitText.min.js"></script>
<script>
  gsap.registerPlugin(SplitText);

  // let tlChars, tlWords, tlLines;
  let splitChars, splitWords, splitLines, splitLinesMask, tl;

  const setSplitText = () => {
    // リセット
    splitChars && splitChars.revert();
    splitWords && splitWords.revert();
    splitLines && splitLines.revert();
    splitLinesMask && splitLinesMask.revert();

    splitChars = SplitText.create(".js-split-chars", { type: "chars" });
    splitWords = SplitText.create(".js-split-words", { type: "words" });
    splitLines = SplitText.create(".js-split-lines", { type: "lines" });
    splitLinesMask = SplitText.create(".js-split-lines-mask", { type: "lines", mask: "lines" }); // 指定した要素を二重でラップしてマスク
  }

  const setAnimation = () => {
    // リセット
    tl && tl.kill();

    tl = gsap.timeline({ defaults: {duration: 0.8, ease: "power4.out"} });
    // tl = gsap.timeline({ defaults: {duration: 0.7, ease: "back.out(2.4)" } });
    tl.from(splitChars.chars, { y: 40, autoAlpha: 0, stagger: 0.04 }, 0)
      .from(splitWords.words, { y: 40, autoAlpha: 0, stagger: 0.2 }, 0.3)
      .from(splitLines.lines, { y: 40, autoAlpha: 0, stagger: 0.2 }, 0.6)
      .from(splitLinesMask.lines, { y: 40, stagger: 0.2 }, 0.9);
  }

  setSplitText();
  setAnimation();

  const playBtn = document.querySelector('.js-play-btn');
  playBtn.addEventListener('click', () => {
    tl.restart();
  });

  // ボタンホバー
  const splitBtnBefore = new SplitText(".btn__txt-item--before", { type: "chars", tag: "span" });
  const splitBtnAfter  = new SplitText(".btn__txt-item--after",  { type: "chars", tag: "span" });

  gsap.set(splitBtnBefore.chars, { yPercent: 0 });
  gsap.set(splitBtnAfter.chars,  { yPercent: 100 });

  const tlBtn = gsap.timeline({
    paused: true,
    defaults: { duration: 0.4, ease: "circ.inOut" }
  })
  .to(splitBtnBefore.chars, { yPercent: -100, stagger: { each: 0.02, from: 0 } }, 0)
  .to(splitBtnAfter.chars,  { yPercent: 0,     stagger: { each: 0.02, from: 0 } }, 0);

  playBtn.addEventListener('mouseenter', () => tlBtn.play());
  playBtn.addEventListener('mouseleave', () => tlBtn.reverse());


  // リサイズ処理
  let resizeTimer;
  window.addEventListener('resize', () => {
    clearTimeout(resizeTimer);
    resizeTimer = setTimeout(() => {
      setSplitText();
      setAnimation();
    }, 100);
  });
</script>

</body>
</html>
